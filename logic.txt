
# NPC 사망, 부활 및 피격 로직 분석

## 1. NPC 사망 및 부활 시스템

### 목적 및 의도
- NPC가 플레이어와의 상호작용(공격)을 통해 죽을 수 있도록 하여 게임에 현실감과 동적인 요소를 부여합니다.
- 사망한 NPC가 일정 시간 후 다시 생성(부활)되도록 하여 플레이어가 지속적으로 상호작용할 콘텐츠를 제공하고 월드의 공백 상태를 방지합니다.

### 로직 설명
1.  **사망 처리 (Death Handling):**
    -   NPC는 `TakeDamage` 함수를 통해 피해를 받으면 `health_` 속성이 감소합니다.
    -   `health_`가 0 이하가 되면, `isDead_` 상태 플래그가 `true`로 설정되어 사망 상태임을 나타냅니다.
    -   사망 시, 'Death' 애니메이션이 한 번 재생됩니다.
    -   `respawnTimer_`가 5초와 같은 특정 시간으로 설정됩니다.
    -   NPC가 사망한 상태(`isDead_`가 `true`)에서는 공격, 이동 등 다른 모든 행동 로직이 비활성화되고, 부활 타이머만 `Update` 함수 내에서 감소합니다.

2.  **부활 처리 (Respawn Handling):**
    -   `Update` 함수는 매 프레임 `respawnTimer_`를 확인하고, 이 값이 0 이하가 되면 `Respawn_` 함수를 호출합니다.
    -   `Respawn_` 함수는 다음의 과정을 통해 NPC를 부활시킵니다:
        -   `health_`를 최대치로 복원합니다.
        -   `isDead_` 플래그를 `false`로 되돌려 다시 활성 상태로 만듭니다.
        -   사망 시 보이지 않게 처리했던 NPC 모델을 다시 보이도록 설정합니다.
        -   `map.js`에 정의된 맵 경계 내에서 무작위 좌표를 생성하여 NPC를 새로운 위치로 이동시킵니다. 이는 플레이어가 같은 위치에서만 NPC를 계속 사냥하는 것을 방지합니다.
        -   NPC의 애니메이션을 기본 대기 상태인 'Idle'로 초기화합니다.

## 2. 피격 애니메이션 (ReceiveHit) 로직

### 목적 및 의도
-   플레이어나 NPC가 피해를 입었을 때 시각적인 피드백(피격 모션)을 제공하여 타격감을 향상시키고, 캐릭터가 공격에 반응하고 있음을 명확히 보여줍니다.
-   피격 애니메이션 재생 중에는 다른 행동을 잠시 멈추게 하여, 공격의 경직 효과를 구현하고 게임 플레이에 전략적 요소를 더합니다.

### 로직 설명
1.  **피격 감지 (Hit Detection):**
    -   플레이어나 NPC가 `TakeDamage` 함수를 통해 피해를 입었을 때, 체력이 0보다 크면 'ReceiveHit' 애니메이션을 재생하도록 `SetAnimation_('ReceiveHit')` 함수를 호출합니다.

2.  **애니메이션 재생 (Animation Playback):**
    -   `SetAnimation_` 함수는 현재 재생 중이던 애니메이션(예: 'Idle', 'Walk')을 부드럽게 중지시키고 'ReceiveHit' 애니메이션으로 전환하여 재생합니다.
    -   'ReceiveHit' 애니메이션은 한 번만 재생되도록 설정되어 있습니다 (`LoopOnce`).

3.  **상태 복귀 (State Reversion):**
    -   'ReceiveHit' 애니메이션 재생이 완료되면, 애니메이션 믹서(`mixer_`)에서 `finished` 이벤트가 발생합니다.
    -   이 이벤트 리스너는 애니메이션이 끝난 후 캐릭터의 상태를 확인하여, 사망 상태가 아니라면 다시 기본 상태('Idle' 또는 이동 상태 'Walk'/'Run') 애니메이션으로 자연스럽게 전환합니다.
    -   이를 통해 캐릭터는 피격 모션을 취한 후 다시 원래의 행동 흐름으로 돌아가게 됩니다.
